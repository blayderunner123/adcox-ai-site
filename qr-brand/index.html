<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Adcox.AI — Branded QR Generator</title>

  <!-- Bootstrap 5 -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    crossorigin="anonymous"
  />

  <!-- Theme colors -->
  <style>
    body {
      background: radial-gradient(1200px 600px at 10% 10%, rgba(125,211,252,.06), transparent 10%),
                  linear-gradient(180deg, #071028 0%, #0f1724 100%);
      color:#e6eef8;
    }
    .cardish {background: rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.18);border-radius:12px;}
    .form-label {color:#cfe0ff;}
    .navbar-dark .navbar-nav .nav-link {color:rgba(255,255,255,.55);}
    .navbar-dark .navbar-nav .nav-link:hover {color:rgba(255,255,255,.75);}
    .navbar-dark .navbar-nav .nav-link.active {color:#fff;}
  </style>

  <!-- Load QRCode library (local copy) -->
  <script src="qrcode.js" defer></script>
</head>

<body>
  <nav class="navbar navbar-expand-md navbar-dark" style="background:rgba(0,0,0,.25)">
    <div class="container">
      <a class="navbar-brand fw-bold" href="/">
        <img src="/favicon/favicon-32x32.png" width="28" height="28" class="d-inline-block align-text-top" alt="">
        ADCOX.AI
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="nav" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="/#about">About</a></li>
          <li class="nav-item"><a class="nav-link" href="/#resume">Résumé</a></li>
          <li class="nav-item"><a class="nav-link" href="/#work">Adventures</a></li>
          <li class="nav-item"><a class="nav-link" href="/#weekly">Weekly</a></li>
          <li class="nav-item"><a class="nav-link" href="/#contact">Contact</a></li>
          <li class="nav-item"><a class="nav-link" href="/ask-ai/">Ask AI</a></li>
          <li class="nav-item"><a class="nav-link active" href="/qr-brand/">QR Maker</a></li>
          <li class="nav-item"><a class="nav-link" href="/metrics-api/">Metrics</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container my-4" style="max-width:960px;">
    <header class="text-center mb-4">
      <div class="badge text-bg-info">Adcox.ai Utility</div>
      <h1 class="mt-2">Branded QR Generator</h1>
      <p class="text-secondary mb-0">Generate a scannable QR with your logo &amp; color. 100% client-side.</p>
    </header>

    <div class="row g-4">
      <div class="col-lg-5">
        <section class="p-3 p-md-4 cardish">
          <div class="mb-3">
            <label class="form-label" for="qrText">Destination URL or Text</label>
            <input id="qrText" class="form-control" type="url" placeholder="https://www.adcox.ai" value="https://www.adcox.ai">
          </div>

          <div class="mb-3">
            <label class="form-label" for="darkColor">Data (dark) color</label>
            <input id="darkColor" class="form-control form-control-color" type="color" value="#000000">
          </div>

          <div class="mb-3">
            <label class="form-label" for="logoFile">Center logo (PNG/SVG/JPG)</label>
            <input id="logoFile" class="form-control" type="file" accept=".png,.jpg,.jpeg,.svg">
            <div class="form-text">Transparent PNG looks best.</div>
          </div>

          <div class="mb-3">
            <label class="form-label" for="logoScale">Logo size: <span id="logoScaleVal">18</span>% of QR width</label>
            <input id="logoScale" class="form-range" type="range" min="10" max="25" step="1" value="18">
          </div>

          <div class="mb-3">
            <label class="form-label" for="qrSize">QR size (px): <span id="qrSizeVal">512</span></label>
            <input id="qrSize" class="form-range" type="range" min="256" max="1024" step="64" value="512">
          </div>

          <div class="d-grid gap-2 mt-4">
            <button id="generateBtn" class="btn btn-outline-light">Generate</button>
            <button id="downloadBtn" class="btn btn-outline-light" disabled>Download PNG</button>
          </div>
        </section>
      </div>

      <div class="col-lg-7">
        <section class="p-3 p-md-4 cardish text-center">
          <canvas id="previewCanvas" width="512" height="512" aria-label="QR preview"></canvas>
          <div class="mt-2 text-secondary">Tip: scan the preview with your phone to test.</div>
        </section>
      </div>
    </div>
  </main>

  <!-- App code (after DOM + after QR library) -->
  <script>
    const qrText = document.getElementById('qrText');
    const darkColor = document.getElementById('darkColor');
    const logoFile = document.getElementById('logoFile');
    const logoScale = document.getElementById('logoScale');
    const logoScaleVal = document.getElementById('logoScaleVal');
    const qrSize = document.getElementById('qrSize');
    const qrSizeVal = document.getElementById('qrSizeVal');
    const canvas = document.getElementById('previewCanvas');
    const ctx = canvas.getContext('2d');
    const genBtn = document.getElementById('generateBtn');
    const dlBtn = document.getElementById('downloadBtn');

    logoScale.addEventListener('input', () => logoScaleVal.textContent = logoScale.value);
    qrSize.addEventListener('input', () => qrSizeVal.textContent = qrSize.value);

    let logoImage = null;
    logoFile.addEventListener('change', e => {
      const f = e.target.files?.[0];
      if (!f) { logoImage = null; return; }
      const reader = new FileReader();
      reader.onload = () => { const img = new Image(); img.onload = () => logoImage = img; img.src = reader.result; };
      reader.readAsDataURL(f);
    });

    // Make renderQR global so other code could call it if needed
    window.renderQR = async function renderQR() {
      const text = (qrText.value.trim() || location.origin);
      const size = parseInt(qrSize.value, 10);
      const dark = darkColor.value;
      if (!text) return alert('Please enter a URL or text.');

      canvas.width = canvas.height = size;

      await window.QRCode.toCanvas(canvas, text, {
        errorCorrectionLevel: 'H',
        margin: 4,
        width: size,
        color: { dark, light: '#FFFFFF' }
      });

      if (logoImage) {
        const scale = Number(logoScale.value) / 100;
        const w = Math.floor(size * scale);
        const h = Math.floor(logoImage.height * (w / logoImage.width));
        const x = Math.floor((size - w) / 2);
        const y = Math.floor((size - h) / 2);
        const pad = Math.ceil(w * 0.06);
        ctx.fillStyle = '#FFFFFF';
        ctx.fillRect(x - pad, y - pad, w + pad*2, h + pad*2);
        ctx.drawImage(logoImage, x, y, w, h);
      }

      dlBtn.disabled = false;
    };

    function waitForLibThenRender()
	{
      if (window.QRCode && typeof window.QRCode.toCanvas === 'function')
	  {
        window.renderQR();
      } else
	  {
        setTimeout(waitForLibThenRender, 50);
      }
    }

    document.addEventListener('DOMContentLoaded', waitForLibThenRender);
    genBtn.addEventListener('click', window.renderQR);

    dlBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      const base = (qrText.value || 'qr')
        .replace(/^https?:\/\//,'')
        .replace(/^www\./,'')
        .replace(/[^\w\-]+/g,'-')
        .replace(/-+/g,'-')
        .replace(/^-|-$/g,'');
      link.download = `${base || 'qr'}-${qrSize.value}.png`;
      link.href = canvas.toDataURL('image/png');
      link.click();
    });
  </script>
	<script>
	  // Ignore noisy extension promise errors
	  window.addEventListener('unhandledrejection', (e) => {
		const msg = String(e.reason || '');
		if (msg.includes('Could not establish connection') && msg.includes('Receiving end does not exist')) {
		  e.preventDefault();
		  console.debug('[note] Ignored extension error:', msg);
		}
	  });
	</script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>