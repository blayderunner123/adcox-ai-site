<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Ask Adcox AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap for badge -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Prism CSS -->
  <link rel="stylesheet" href="https://unpkg.com/prismjs/themes/prism.min.css" />

  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; line-height: 1.55; margin: 2rem; }
    nav a { text-decoration: none; color: inherit; }
    nav a:hover { text-decoration: underline; }
    .toolbar { display: flex; gap: .75rem; align-items: center; margin: 1rem 0; flex-wrap: wrap; }
    .toolbar label { font-size: .9rem; opacity: .8; }
    .toolbar select, .toolbar input, .toolbar button {
      padding: .55rem .7rem; border-radius: 6px; border: 1px solid #ddd; background: #fff;
    }
    #answer-wrap { max-width: 72ch; border: 1px solid #eee; border-radius: 10px; padding: 1rem; background: #fff; }
    #answer { min-height: 80px; }
    #answer p { margin: 1em 0; }
    pre[class*="language-"] { border: 1px solid #eee; border-radius: 8px; padding: 1rem; overflow: auto; }
    code[class*="language-"], pre { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 0.95rem; }
    :not(pre) > code { background: #f6f8fa; padding: 0.15em 0.35em; border-radius: 4px; }
    #answer ul, #answer ol { margin: 0.75em 0 0.75em 1.25em; }
    #answer a { color: #0a58ca; text-decoration: underline; }
    #status { opacity: 0.7; margin: .25rem 0 1rem; min-height: 1.2em; }
    .tagline { font-size: .95rem; opacity: .8; margin-top: -.25rem; margin-bottom: 1.25rem; }
    button { cursor: pointer; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
  </style>
</head>
<body>
  <nav style="margin-bottom:1rem">
    <a href="../index.html">Home</a> • <a href="./index.html">Ask Adcox AI</a>
  </nav>

  <h1>Ask Adcox AI</h1>
  <p class="tagline">Ask anything — your browser keeps your secrets.</p>

  <form id="ask-form" class="toolbar">
    <input id="q" name="q" placeholder="Ask something..." style="width: 42ch;" />
    <label for="version">Version</label>
    <select id="version" name="version" title="Choose the backend version">
      <option value="v1" data-endpoint="https://68dfe975002e94119063.nyc.appwrite.run/">Stable (v1)</option>
      <option value="v2" data-endpoint="https://68dfe975002e94119063.nyc.appwrite.run/">Preview (v2)</option>
      <option value="v3" data-endpoint="https://68dfe975002e94119063.nyc.appwrite.run/" selected>Experimental (v3)</option>
    </select>
    <button id="submit" type="submit">Ask</button>
  </form>

  <div id="status" aria-live="polite"></div>

  <div id="answer-wrap">
    <div id="answer"></div>
    <div class="text-end mt-3">
      <span class="badge bg-secondary">Version 3</span>
    </div>
  </div>

  <!-- DOMPurify, marked, Prism -->
  <script src="https://unpkg.com/dompurify@3.1.7/dist/purify.min.js"></script>
  <script src="https://unpkg.com/marked@12.0.2/marked.min.js"></script>
  <script src="https://unpkg.com/prismjs/prism.js"></script>
  <script src="https://unpkg.com/prismjs/components/prism-bash.min.js"></script>
  <script src="https://unpkg.com/prismjs/components/prism-powershell.min.js"></script>
  <script src="https://unpkg.com/prismjs/components/prism-json.min.js"></script>
  <script src="https://unpkg.com/prismjs/components/prism-javascript.min.js"></script>
  <script src="https://unpkg.com/prismjs/components/prism-typescript.min.js"></script>
  <script src="https://unpkg.com/prismjs/components/prism-markdown.min.js"></script>

  <script>
    const form = document.getElementById('ask-form');
    const input = document.getElementById('q');
    const statusEl = document.getElementById('status');
    const answerEl = document.getElementById('answer');
    const submitBtn = document.getElementById('submit');
    const versionEl = document.getElementById('version');

    let API_URL = 'https://68dfe975002e94119063.nyc.appwrite.run/';
    marked.setOptions({ breaks: true, gfm: true, headerIds: true });

    versionEl.addEventListener('change', () => {
      const opt = versionEl.selectedOptions[0];
      const ep = opt?.dataset?.endpoint;
      if (ep) API_URL = ep;
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const q = input.value.trim();
      if (!q) return;

      const selectedVersion = versionEl.value;

      submitBtn.disabled = true;
      statusEl.textContent = 'Thinking…';
      answerEl.innerHTML = '';

      try {
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ q, version: selectedVersion })
        });

        if (!res.ok) {
          const txt = await res.text().catch(() => '');
          throw new Error(`HTTP ${res.status} — ${txt}`);
        }

        const markdown = await res.text();
        const rawHtml = marked.parse(markdown);
        const safeHtml = DOMPurify.sanitize(rawHtml, { USE_PROFILES: { html: true } });
        answerEl.innerHTML = safeHtml;
        Prism.highlightAllUnder(answerEl);

        statusEl.textContent = 'Done.';
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'Error fetching answer.';
        answerEl.innerHTML = `<pre>${DOMPurify.sanitize(String(err))}</pre>`;
      } finally {
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>