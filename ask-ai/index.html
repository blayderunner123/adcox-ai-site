<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Ask AI â€” Appwrite</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- Bootstrap 5 (CSS) via public CDN -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />
  <style>
    :root { font-family: system-ui, Arial, sans-serif; }
    body { margin: 0; padding: 24px; background:#0b1020; color:#e8eefc; }
    .wrap { max-width: 840px; margin: 0 auto; }
    h1 { margin: 0 0 12px; font-size: 1.25rem; opacity:.9 }
    form { display:flex; gap:8px; margin: 12px 0 16px; }
    input[type="text"] { flex:1; padding:12px; border-radius:12px; border:1px solid #2a3358; background:#0f1733; color:#e8eefc; }
    button { padding:12px 16px; border-radius:12px; border:0; background:#5b8cff; color:#0b1020; font-weight:700; cursor:pointer; }
    .status { font-size:.9rem; opacity:.8; margin: 6px 0 12px; }
    .card { background:#0f1733; border:1px solid #2a3358; border-radius:16px; padding:16px; }
    .answer { white-space: pre-wrap; line-height:1.45 }
    .spinner { display:inline-block; width:1em; height:1em; border:.18em solid #5b8cff; border-top-color:transparent; border-radius:50%; animation:spin 1s linear infinite; vertical-align:-.2em }
    @keyframes spin { to { transform:rotate(360deg) } }
    .small { font-size:.85rem; opacity:.75 }
    .muted { opacity:.7 }
  </style>
</head>
<body>
  <!-- Navbar (relative links from /ask-ai/) -->
  <nav class="navbar navbar-expand-md navbar-dark" style="background:rgba(0,0,0,.25)">
    <div class="container">
      <a class="navbar-brand fw-bold" href="../">ADCOX.AI</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="nav" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="../">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="../#about">About</a></li>
          <li class="nav-item"><a class="nav-link" href="../#resume">RÃ©sumÃ©</a></li>
          <li class="nav-item"><a class="nav-link" href="../#work">Adventures</a></li>
          <li class="nav-item"><a class="nav-link" href="../#weekly">Weekly</a></li>
          <li class="nav-item"><a class="nav-link" href="../#contact">Contact</a></li>
          <li class="nav-item ms-2">
            <a class="nav-link active" aria-current="page" href="./">Ask AI</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="wrap">
    <h1>Ask AI</h1>
    <div class="small muted">This page calls your Appwrite Function, which calls the model server-side. Your OpenAI key never touches the browser.</div>

    <form id="ask-form">
      <input id="q" type="text" placeholder="Ask a questionâ€¦" autocomplete="off" />
      <button id="submit" type="submit">Ask</button>
    </form>

    <div class="status" id="status">Idle.</div>

    <div class="card"><div class="answer" id="answer">Ask something to get started.</div></div>
  </div>

  <!-- Appwrite Web SDK (ESM) -->
  <script type="module">
    import { Client, Functions } from "https://cdn.jsdelivr.net/npm/appwrite@13.0.0/dist/esm/index.js";

    // ðŸ”§ Replace these two with real values
    const PROJECT_ID  = "68dc4969001a1ce12c8a";
    const FUNCTION_ID = "68dec41a003e14c02ae1";

    const client = new Client()
      .setEndpoint("https://cloud.appwrite.io/v1")
      .setProject(PROJECT_ID);

    const functions = new Functions(client);

    const statusEl  = document.getElementById('status');
    const answerEl  = document.getElementById('answer');
    const form      = document.getElementById('ask-form');
    const input     = document.getElementById('q');
    const submitBtn = document.getElementById('submit');

    async function askAI(q) {
      const exec = await functions.createExecution(
        FUNCTION_ID,
        JSON.stringify({ q }),
        false, // wait for completion
        "",
        "POST",
        { "Content-Type": "application/json" }
      );
      const payload = JSON.parse(exec.response || "{}");
      return payload.answer || payload.error || "(no response)";
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const q = input.value.trim();
      if (!q) return;
      submitBtn.disabled = true; input.disabled = true;
      statusEl.innerHTML = `Thinkingâ€¦ <span class="spinner"></span>`;
      answerEl.textContent = "";

      try {
        const a = await askAI(q);
        answerEl.textContent = a;
        statusEl.textContent = "Done.";
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Error talking to the function.";
      } finally {
        submitBtn.disabled = false; input.disabled = false; input.select();
      }
    });
  </script>
</body>
</html>